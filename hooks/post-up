#!/usr/bin/env bash

PATH="$HOME/.nodenv/bin:$HOME/.rbenv/bin:$PATH"

# Setup vim-plug
if [ -e "$HOME"/.vim/autoload/plug.vim ]; then
  vim -E -s +PlugUpgrade +qa
else
  curl -fLo "$HOME"/.vim/autoload/plug.vim --create-dirs \
      https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
  vim -E -s +PlugInstall +qa
fi

if ! base16-manager list | grep -q chriskempson/base16-shell; then
  base16-manager install chriskempson/base16-shell
fi

if ! base16-manager list | grep -q chriskempson/base16-vim; then
  base16-manager install chriskempson/base16-vim
fi

base16-manager set eighties

echo "Configuring Ruby ..."
find_latest_ruby() {
  rbenv install -l | grep -v - | tail -1 | sed -e 's/^ *//'
}

ruby_version="$(find_latest_ruby)"
eval "$(rbenv init -)"

if ! rbenv versions | grep -Fq "$ruby_version"; then
  rbenv install -s "$ruby_version"
fi

rbenv global "$ruby_version"
rbenv shell "$ruby_version"
gem update --system
gem install 'bundler'
number_of_cores=$(sysctl -n hw.ncpu)
bundle config --global jobs $((number_of_cores - 1))

nodenv default-packages install --all

echo "Configuring Python for NeoVim ..."
pip3 install neovim

tic -x ~/.config/terminfo/tmux-256color-italic.terminfo
tic -x ~/.config/terminfo/xterm-256color-italic.terminfo
