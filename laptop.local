#!/usr/bin/env bash
set -e

hash mas 2>/dev/null || brew install mas

if ! mas account >/dev/null; then
  echo -n "Mac App Store Password:"
  read -rs password
  echo
  mas signin "jacob@jacobsmith.io" "$password"
fi

# Install Xcode
mas install 497799835
sudo xcodebuild -license accept

brew bundle --file=- <<EOF
tap "Goles/battery"
brew "battery"

tap "homebrew/dupes"
brew "less"

brew "awscli"
brew "cmake"
brew "coreutils"
brew "emojify"
brew "exercism"
brew "findutils"
brew "flow"
brew "fzf"
brew "gawk"
brew "ghc"
brew "gifsicle"
brew "gist"
brew "hub"
brew "jq"
brew "leiningen"
brew "macvim"
brew "phantomjs"
brew "rmtrash"
brew "rust"
brew "ssh-copy-id"
brew "the_silver_searcher"
brew "tig"
brew "tmate"
brew "tree"
brew "watchman"
brew "yarn"
brew "youtube-dl"

tap "caskroom/fonts"
cask "font-fira-code"

tap "caskroom/versions"
cask "alfred2"

cask "1password"
cask "appcleaner"
cask "arq"
cask "dash"
cask "docker"
cask "dropbox"
cask "duet"
cask "fluid"
cask "flux"
cask "font-fontawesome"
cask "google-chrome"
cask "hammerspoon"
cask "iterm2"
cask "java"
cask "karabiner-elements"
cask "marked"
cask "monodraw"
cask "send-to-kindle"
cask "sketch"
cask "screenflow5"
cask "slack"
cask "spotify"
cask "steam"
cask "vagrant"
cask "virtualbox"

brew "qt5", args: ['with-qtwebkit']

mas 'Pages', id: 409201541
mas 'Keynote', id: 409183694
mas 'Numbers', id: 409203825

mas 'Airmail 2', id: 918858936
mas 'DaisyDisk', id: 411643860
mas 'Fantastical', id: 435003921
mas 'Pixelmator', id: 407963104
mas 'ReadKit', id: 588726889
mas 'Shush', id: 496437906
mas 'Transmit', id: 403388562
mas 'iA Writer', id: 775737590
mas 'xScope', id: 889428659
EOF

# qt is keg-only, but webkit-capybara needs the qmake binary
hash qmake 2>/dev/null || brew link --force qt5

echo "Cleaning up old Homebrew formulae ..."
brew cleanup
brew cask cleanup

rcup -d $HOME/.dotfiles-thoughtbot -f
RCRC="$HOME/.dotfiles/rcrc" rcup -f
